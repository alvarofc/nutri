---
import Layout from '../../layouts/Layout.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/ui';

const lang = 'es'; // Default to Spanish for the root blog
const t = useTranslations(lang);

const posts = import.meta.glob('./posts/*.md');
let allPosts = await Promise.all(
  Object.entries(posts).map(async ([path, resolver]) => {
    const post = await resolver();
    // Transform "./posts/first-post.md" -> "/blog/posts/first-post"
    // Or if the file structure expects "/blog/first-post", we need to check where the pages are generated.
    // Astro pages at src/pages/blog/posts/*.md would be /blog/posts/*
    // But wait, src/pages/blog/posts/ exists?
    // Let's check the file list again.
    // src/pages/blog/posts/firs-post.md
    // So the URL is /blog/posts/firs-post
    return { ...post, url: path.replace(/\.md$/, '').replace(/^\./, '/blog') };
  })
);
let tags = new Set<string>();
let filteredPosts = allPosts.filter((post) => {
  post.frontmatter.tags.forEach((tag: string) => tags.add(tag));
  return post;
});
---

<Layout title="Journal" description="Journal de Alexandra • Ideas, recomendaciones y consejos que me gusta compartir.">
  <section class="py-24 sm:py-32 bg-stone-50">
    <div class="mx-auto max-w-2xl px-6 lg:max-w-7xl lg:px-8">
      
      <!-- Header -->
      <div class="flex flex-col gap-12 border-b border-blue-900/10 pb-12 mb-16 lg:flex-row lg:items-end lg:justify-between">
        <div class="flex flex-col gap-6">
          <h1 class="text-6xl font-serif text-blue-950 sm:text-7xl md:text-8xl">Journal</h1>
          <p class="max-w-xl text-xl text-blue-900/60 font-light">
            Ideas, recomendaciones y consejos que me gusta compartir.
          </p>
        </div>
        
        <!-- Tags -->
        <div class="flex flex-wrap gap-4 lg:justify-end">
          {
            [...tags].map((tag) => (
              <a href={`/blog/${tag}`} class="px-4 py-2 text-sm uppercase tracking-widest text-blue-950 border border-blue-900/20 hover:bg-blue-900 hover:text-white transition-colors">
                {tag}
              </a>
            ))
          }
        </div>
      </div>

      <!-- Grid -->
      <div class="grid gap-x-8 gap-y-20 lg:grid-cols-3">
        {
          filteredPosts.map((post) => (
            <article class="flex flex-col group">
              <a href={post.url} class="block overflow-hidden">
                <img
                  src={post.frontmatter.imgUrl}
                  alt={post.frontmatter.imgAlt}
                  class="aspect-[4/5] w-full object-cover bg-stone-200 transition-transform duration-500 group-hover:scale-105"
                />
              </a>
              <div class="mt-8 flex flex-col gap-4">
                <div class="flex items-center gap-4 text-xs font-medium tracking-widest text-blue-900/50 uppercase">
                  <time datetime={post.frontmatter.pubDate}>{post.frontmatter.pubDate.substring(0, 10)}</time>
                  <span>•</span>
                  <span>{post.frontmatter.tags[0]}</span>
                </div>
                <h3 class="text-3xl font-serif text-blue-950 leading-tight group-hover:underline decoration-1 underline-offset-4">
                  <a href={post.url}>
                    {post.frontmatter.title}
                  </a>
                </h3>
                <p class="text-blue-900/70 text-lg leading-relaxed line-clamp-3">
                  {post.frontmatter.description}
                </p>
                <a
                  href={post.url}
                  class="mt-4 text-sm font-bold tracking-widest uppercase border-b border-blue-900/30 pb-1 self-start group-hover:border-blue-900 transition-colors"
                >
                  Leer Artículo
                </a>
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </section>
</Layout>
